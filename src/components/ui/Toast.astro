---
/**
 * Toast notification container component
 *
 * Subscribes to the toast store and renders toast notifications
 * with proper accessibility attributes and DOM manipulation.
 *
 * @remarks
 * This component automatically manages toast lifecycle including
 * rendering, animations, and removal. No props required.
 */
---

<div id="toast-container" role="status" aria-live="polite" aria-atomic="true" class="toast toast-end toast-bottom z-50"></div>

<script>
  import { toasts, removeToast } from '../../lib/toastStore';
  import type { Toast } from '../../lib/toastStore';
  import { createIconElement } from '../../lib/icons';
  import { initializeOnce } from '../../lib/client-utils';

  /**
   * Create toast alert element using DOM methods (no innerHTML for security)
   */
  function createToastElement(toast: Toast): HTMLElement {
    const alertDiv = document.createElement('div');

    // Map types to DaisyUI alert classes
    const alertClasses: Record<Toast['type'], string> = {
      info: 'alert-info',
      success: 'alert-success',
      warning: 'alert-warning',
      error: 'alert-error',
    };

    alertDiv.className = `alert ${alertClasses[toast.type]} shadow-lg`;

    // Create and append icon using shared icon utility
    const icon = createIconElement(toast.type, 'lg');
    alertDiv.appendChild(icon);

    // Create and append message
    const messageSpan = document.createElement('span');
    messageSpan.textContent = toast.message;
    alertDiv.appendChild(messageSpan);

    // Create and append close button
    const closeBtn = document.createElement('button');
    closeBtn.className = 'btn btn-xs btn-ghost';
    closeBtn.textContent = 'âœ•';
    closeBtn.setAttribute('aria-label', 'Close notification');
    closeBtn.dataset.id = toast.id;
    closeBtn.addEventListener('click', () => {
      removeToast(toast.id);
    });
    alertDiv.appendChild(closeBtn);

    return alertDiv;
  }

  /**
   * Initialize toast container and subscribe to store updates
   */
  function initToasts() {
    const container = document.getElementById('toast-container');

    if (container) {
      toasts.subscribe((currentToasts) => {
        // Clear current content
        while (container.firstChild) {
          container.removeChild(container.firstChild);
        }

        // Render toasts using DOM methods
        currentToasts.forEach((toast) => {
          const toastElement = createToastElement(toast);
          container.appendChild(toastElement);
        });
      });
    }
  }

  // Initialize once and re-initialize on Astro page transitions
  initializeOnce('toasts', initToasts);
  document.addEventListener('astro:page-load', () => {
    initializeOnce('toasts', initToasts);
  });
</script>
